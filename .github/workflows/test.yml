name: Test sofa-setup-action

on:
  workflow_dispatch:
  push:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  run:
    name: Run on ${{ matrix.os }} with SOFA ${{ matrix.sofa_branch }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-22.04, macos-13, windows-2022]
        sofa_branch: [master]

    steps:
      - name: Setup SOFA and environment
        id: sofa
        uses: sofa-framework/sofa-setup-action@v4
        with:
          sofa_root: ${{ github.workspace }}/sofa
          sofa_version: ${{ matrix.sofa_branch }}
          sofa_scope: 'full'


      - name: Clone regression for ref folder
        id: clone-regression
        shell: bash
        run: |
          cd ${{ github.workspace }}/sofa/share/sofa
          mkdir applications && cd applications
          mkdir projects && cd projects 
          git clone https://github.com/sofa-framework/Regression.git
          cd ${{ github.workspace }}

      - name: Launch test
        id: tests
        uses: bakpaul/sofa-test-action@only_add_regression
        with:
          sofa_install_path: ${{ github.workspace }}/sofa
          regression_file_path: ${{ github.workspace }}/sofa/share/sofa/examples
          sofa_version: ${{ matrix.sofa_branch }}


